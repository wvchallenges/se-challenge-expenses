{% extends 'base.html' %}
{% load humanize csvloader %}
{% block maincontent %}

<div class="clearfix">
    <h4 class="pull-left">Sales Tax Details</h4>
    <a class="pull-right btn btn-primary toggle" data-toggle="collapse" data-target="#taxes">Toggle</a>
</div>
<table id="taxes" class="table collapse in">
    <thead>
        <tr>
            <td>Year</td>
            {% for tax_name in tax_types %}
                <td>{{ tax_name }}</td>
            {% endfor %}
        </tr>
    </thead>
    <tbody>
        {% regroup expenses by year as by_year %}
        {% for year in by_year %}
        <tr>
            <td>{{ year.grouper }}</td>
            {% for tax_name in tax_types %}
                <td>{{ year.list|expenses_for_tax:tax_name|sum_field:'tax_amount' }}</td>
            {% endfor %}
        </tr>
        {% endfor %}
    </tbody>
</table>

<div class="clearfix">
	<h4 class="pull-left">All Expenses</h4>
	<a class="pull-right btn btn-primary toggle" data-toggle="collapse" data-target="#expenses">Toggle</a>
</div>
<table id="expenses" class="table table-striped collapse">
    <thead>
        <tr>
            <th>Date</th>
            <th>Category</th>
            <th>Employee</th>
            <th>Employee Address</th>
            <th class="currency">Pre-Tax Amount</th>
            <th>Tax Type</th>
            <th class="currency">Tax Amount</th>
            <th class="currency">Total Amount</th>
        </tr>
    </thead>
    <tbody>
        {% for exp in expenses %}
        <tr class="row-{{ exp.year }}-{{ exp.month_name }}">
            <td class="date">{{ exp.date }}</td>
            <td>{{ exp.category }}</td>
            <td>{{ exp.employee_name }}</td>
            <td>{{ exp.employee_address }}</td>
            <td class="currency">{{ exp.pre_tax_amount|floatformat:2|intcomma }}</td>
            <td>{{ exp.tax.tax_name }}</td>
            <td class="currency">{{ exp.tax.tax_amount|floatformat:2|intcomma }}</td>
            <td class="currency">{{ exp.total_amount|floatformat:2|intcomma }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}